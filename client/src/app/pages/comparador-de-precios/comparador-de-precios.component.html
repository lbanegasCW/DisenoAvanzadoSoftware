<section class="page-container page-section">
  <div class="page-hero">
    <h1 class="page-title" i18n="@@comparador.title">Comparador de precios</h1>
    <p class="page-subtitle" i18n="@@comparador.subtitle">
      Visualiz√° r√°pidamente d√≥nde conviene comprar tu carrito en la localidad seleccionada.
    </p>
  </div>
</section>

<section class="page-container pb-14">
  <div *ngIf="loading" class="card text-sm font-medium text-slate-600" i18n="@@comparador.loading">Cargando comparaci√≥n‚Ä¶</div>

  <div *ngIf="errorMsg" class="card border-rose-200 bg-rose-50 text-sm font-medium text-rose-700">
    {{ errorMsg }}
  </div>

  <div class="card overflow-x-auto p-0" *ngIf="!loading && vmRows.length">
    <table class="w-full min-w-[720px] text-sm text-slate-700">
      <thead class="bg-slate-50 text-slate-700">
        <tr>
          <th class="px-4 py-3 text-left font-semibold" i18n="@@comparador.col_producto">Producto</th>
          <th class="px-4 py-3 text-left font-semibold" i18n="@@comparador.col_categoria">Categor√≠a</th>
          <th
            *ngFor="let id of colIds; trackBy: trackCol"
            class="px-4 py-3 text-center font-semibold"
            [class.best-column]="id === cheapestSupId"
          >
            <div class="inline-flex items-center gap-2">
              <span>{{ supName(id) }}</span>
              <span *ngIf="id === cheapestSupId" class="winner-chip" i18n="@@comparador.cheapest">üèÜ M√°s barato</span>
            </div>
          </th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let row of vmRows; trackBy: trackRow" class="table-row">
          <td class="px-4 py-3 align-top">
            <p class="font-semibold text-slate-900">{{ row.nomProducto }}</p>
            <p class="mt-1 text-xs text-slate-500"><span i18n="@@comparador.ean_label">EAN</span> {{ row.codBarra }}</p>
          </td>

          <td class="px-4 py-3 align-top text-slate-600">{{ row.nomCategoria }}</td>

          <td
            *ngFor="let id of colIds; trackBy: trackCol"
            class="px-4 py-3 text-center"
            [class.best-column-light]="id === cheapestSupId"
          >
            <ng-container *ngIf="row.pricesBySup[id] !== null && row.pricesBySup[id] !== undefined; else noPrice">
              <span
                class="price-chip"
                [class.price-chip-min]="row.min !== null && row.pricesBySup[id] === row.min"
              >
                {{ formatPrice(+row.pricesBySup[id]!) }}
              </span>
            </ng-container>
            <ng-template #noPrice>
              <span class="text-slate-300">‚Äî</span>
            </ng-template>
          </td>
        </tr>

        <tr class="border-t border-slate-200 bg-slate-50 font-semibold text-slate-900">
          <td class="px-4 py-3" colspan="2" i18n="@@comparador.total">TOTAL</td>
          <td
            *ngFor="let id of colIds; trackBy: trackCol"
            class="px-4 py-3 text-center"
            [class.best-column-light]="id === cheapestSupId"
          >
            <span *ngIf="isCompleteBySup[id]; else incompleto">{{ formatPrice(totalBySup[id]) }}</span>
            <ng-template #incompleto>
              <span class="text-slate-400" i18n="@@comparador.incomplete">Incompleto</span>
            </ng-template>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div *ngIf="!loading && !vmRows.length && !errorMsg" class="card text-sm text-slate-500" i18n="@@comparador.empty_results">
    No hay resultados para comparar. Verific√° que tu carrito tenga productos disponibles en la localidad.
  </div>
</section>
